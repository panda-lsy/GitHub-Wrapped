# ESA Serverless å¹³å°éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ ESA Serverless å¹³å°ä¸ŠæˆåŠŸéƒ¨ç½² GitHub-Wrapped é¡¹ç›®ã€‚

---

## ğŸ“‹ ç›®å½•

- [é—®é¢˜è¯Šæ–­](#é—®é¢˜è¯Šæ–­)
- [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
- [å¹³å°é…ç½®](#å¹³å°é…ç½®)
- [æ„å»ºé…ç½®](#æ„å»ºé…ç½®)
- [éªŒè¯éƒ¨ç½²](#éªŒè¯éƒ¨ç½²)

---

## ğŸ” é—®é¢˜è¯Šæ–­

### åŸå§‹é—®é¢˜

ä»æ„å»ºæ—¥å¿—å‘ç°ï¼š

```bash
âœ… Next.js build æˆåŠŸ
âœ… è·¯ç”±è¯†åˆ«æˆåŠŸï¼ˆ/, /api/auth/[...nextauth], /api/sessionï¼‰
âŒ Function file not found, skipping...
âŒ Zip file created: index.zip, size: 2.82KB  â† å¤ªå°ï¼
```

**æ ¹æœ¬åŸå› **ï¼š
- ESA å¹³å°åªæ‰“åŒ…äº† `public/` ç›®å½•
- **æ²¡æœ‰æ‰“åŒ… `.next/` æ„å»ºäº§ç‰©**
- å› æ­¤ API Routes æ— æ³•éƒ¨ç½²

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒç­–ç•¥

1. **åˆ›å»ºå¹³å°é…ç½®æ–‡ä»¶** (`esa.config.json`) - å‘Šè¯‰å¹³å°æ–‡ä»¶ä½ç½®
2. **æ·»åŠ  ESA ä¸“ç”¨æ„å»ºå‘½ä»¤** (`build:esa`) - ç”Ÿæˆæ­£ç¡®è¾“å‡º
3. **é…ç½®å¹³å°å‚æ•°** - æŒ‡å®šæ­£ç¡®çš„å‡½æ•°æ–‡ä»¶è·¯å¾„

---

## âš™ï¸ å¹³å°é…ç½®

### é…ç½®é¡¹ä¿®æ”¹

åœ¨ ESA Serverless å¹³å°é…ç½®é¡µé¢ï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

#### 1ï¸âƒ£ æ„å»ºå‘½ä»¤

```
åŸæ¥çš„æ„å»ºå‘½ä»¤: npm run build
æ–°çš„æ„å»ºå‘½ä»¤: npm run build:esa
```

**ä¸ºä»€ä¹ˆä¿®æ”¹ï¼Ÿ**
- `npm run build` â†’ ç”Ÿæˆ standalone è¾“å‡ºï¼ˆç”¨äºé˜¿é‡Œäº‘ FCï¼‰
- `npm run build:esa` â†’ æ ‡å‡†æ„å»ºï¼Œäº§ç‰©åœ¨ `.next/` ç›®å½•

#### 2ï¸âƒ£ å‡½æ•°æ–‡ä»¶è·¯å¾„

```
å‡½æ•°æ–‡ä»¶è·¯å¾„: .next/server/app/api
```

**è¯´æ˜**ï¼š
- è¿™æ˜¯æŒ‡å‘ API Routes çš„æ­£ç¡®è·¯å¾„
- å¹³å°å°†ä»è¿™é‡Œæ‰¾åˆ°æ‰€æœ‰å‡½æ•°æ–‡ä»¶

#### 3ï¸âƒ£ å…¶ä»–é…ç½®ä¿æŒä¸å˜

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| å®‰è£…å‘½ä»¤ | `npm install` |
| Node.js ç‰ˆæœ¬ | `22.x` |
| æ ¹ç›®å½• | `/` |
| é™æ€èµ„æºç›®å½• | `public` |

---

## ğŸ”¨ æ„å»ºé…ç½®

### æ–°å¢æ–‡ä»¶è¯´æ˜

#### `esa.config.json`

**ç”¨é€”**ï¼šESA å¹³å°é…ç½®æ–‡ä»¶ï¼Œæ˜ç¡®æŒ‡å®šå‡½æ•°ä½ç½®

**å†…å®¹**ï¼š
```json
{
  "version": "1.0",
  "platform": "esa-serverless",
  "build": {
    "outputDir": ".next",
    "staticDir": "public",
    "functionDir": ".next/server/app/api"
  },
  "functions": [
    {
      "name": "auth",
      "path": ".next/server/app/api/auth/[...nextauth]/route.js",
      "route": "/api/auth/[...nextauth]"
    },
    {
      "name": "session",
      "path": ".next/server/app/api/session/route.js",
      "route": "/api/session"
    }
  ]
}
```

#### `.esaignore`

**ç”¨é€”**ï¼šæ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œå‡å°éƒ¨ç½²åŒ…

**å…³é”®æ’é™¤é¡¹**ï¼š
```
node_modules
.next/cache
.git
.env.local
```

#### `package.json` æ–°å¢è„šæœ¬

**æ–°å¢**ï¼š`build:esa` è„šæœ¬

**å¯¹æ¯”**ï¼š
```json
{
  "scripts": {
    "build": "next build && ...standalone...",     // é˜¿é‡Œäº‘ FC
    "build:esa": "next build",                     // ESA å¹³å°
    "build:fc": "next build && ...standalone..."  // é˜¿é‡Œäº‘ FC å®Œæ•´ç‰ˆ
  }
}
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1ï¼šä¿®æ”¹å¹³å°é…ç½®

åœ¨ ESA å¹³å°æ§åˆ¶å°ï¼š

1. **æ„å»ºå‘½ä»¤**æ”¹ä¸ºï¼š`npm run build:esa`
2. **å‡½æ•°æ–‡ä»¶è·¯å¾„**æ”¹ä¸ºï¼š`.next/server/app/api`

### æ­¥éª¤ 2ï¼šä¿å­˜å¹¶è§¦å‘é‡æ–°éƒ¨ç½²

1. ä¿å­˜é…ç½®æ›´æ”¹
2. è§¦å‘æ‰‹åŠ¨éƒ¨ç½²
3. ç­‰å¾…æ„å»ºå®Œæˆ

### æ­¥éª¤ 3ï¼šéªŒè¯æ„å»ºäº§ç‰©

**é¢„æœŸæ—¥å¿—**ï¼š
```
âœ… Next.js build æˆåŠŸ
âœ… è·¯ç”±è¯†åˆ«æˆåŠŸ
âœ… Function file found: .next/server/app/api/auth/[...nextauth]/route.js
âœ… Function file found: .next/server/app/api/session/route.js
âœ… Zip file created: index.zip, size: ~20-50MB  â† æ­£å¸¸å¤§å°ï¼
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥ API Routes

```bash
# æµ‹è¯•ä¼šè¯ API
curl https://your-domain.com/api/session

# é¢„æœŸå“åº”ï¼š
# {"user":null,"expires":null}
```

### 2. æµ‹è¯•é¦–é¡µ

è®¿é—®éƒ¨ç½²åŸŸåï¼Œç¡®è®¤ï¼š
- [ ] é¡µé¢æ­£å¸¸åŠ è½½
- [ ] ç™»å½•æŒ‰é’®æ˜¾ç¤º
- [ ] CSS æ ·å¼æ­£ç¡®

### 3. æµ‹è¯• GitHub OAuth

- [ ] ç‚¹å‡» "Login with GitHub"
- [ ] è·³è½¬åˆ° GitHub æˆæƒé¡µé¢
- [ ] æˆæƒåè¿”å›åº”ç”¨
- [ ] çœ‹åˆ°ç”¨æˆ·æ•°æ®å’Œ Wrapped å¹»ç¯ç‰‡

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šä»ç„¶æ˜¾ç¤º "Function file not found"

**å¯èƒ½åŸå› **ï¼š
- å‡½æ•°æ–‡ä»¶è·¯å¾„é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
å°è¯•ä»¥ä¸‹è·¯å¾„ï¼ˆé€ä¸ªæµ‹è¯•ï¼‰ï¼š
```
.next/server/app/api
.next/server
.next
(ç•™ç©º)
```

### é—®é¢˜ 2ï¼šAPI è¿”å› 404

**å¯èƒ½åŸå› **ï¼š
- API Routes æ²¡æœ‰æ­£ç¡®éƒ¨ç½²

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ„å»ºæ—¥å¿—ä¸­æ˜¯å¦æœ‰å‡½æ•°æ–‡ä»¶
2. ç¡®è®¤ç¯å¢ƒå˜é‡å·²é…ç½®
3. æŸ¥çœ‹ ESA å¹³å°çš„å‡½æ•°æ—¥å¿—

### é—®é¢˜ 3ï¼šé¡µé¢ç©ºç™½

**å¯èƒ½åŸå› **ï¼š
- é™æ€èµ„æºè·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. ç¡®è®¤ `public/` ç›®å½•å·²æ‰“åŒ…
3. éªŒè¯ `.next/static/` å·²åŒ…å«

### é—®é¢˜ 4ï¼šNEXTAUTH_URL é…ç½®é”™è¯¯

**ç—‡çŠ¶**ï¼š
- ç™»å½•åç«‹å³é€€å‡º
- å›è°ƒ URL é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ›´æ–° NEXTAUTH_URL ä¸ºå®é™…éƒ¨ç½²åŸŸå
NEXTAUTH_URL=https://your-esa-domain.com
```

---

## ğŸ“Š æ„å»ºäº§ç‰©å¯¹æ¯”

### ä¿®æ”¹å‰

```
éƒ¨ç½²åŒ…å¤§å°: 2.82KB
å†…å®¹: public/
å‡½æ•°: âŒ æœªæ‰¾åˆ°
```

### ä¿®æ”¹å

```
éƒ¨ç½²åŒ…å¤§å°: ~20-50MB
å†…å®¹:
  - .next/server/app/api/     â† API Routes
  - .next/server/app/page.js  â† é¡µé¢
  - .next/static/             â† é™æ€èµ„æº
  - public/                   â† å…¬å…±èµ„æº
å‡½æ•°: âœ… æ­£ç¡®è¯†åˆ«
```

---

## ğŸ¯ å…³é”®é…ç½®æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] æ„å»ºå‘½ä»¤å·²æ”¹ä¸º `npm run build:esa`
- [ ] å‡½æ•°æ–‡ä»¶è·¯å¾„é…ç½®ä¸º `.next/server/app/api`
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆNEXTAUTH_URL, NEXTAUTH_SECRET ç­‰ï¼‰
- [ ] `esa.config.json` å·²æäº¤åˆ°ä»“åº“
- [ ] `.esaignore` å·²æäº¤åˆ°ä»“åº“

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### Next.js æ„å»ºäº§ç‰©ç»“æ„

```
.next/
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/[...nextauth]/route.js  â† å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ session/route.js            â† å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ page.js                         â† é¦–é¡µ
â”‚   â”‚   â””â”€â”€ layout.js                       â† å¸ƒå±€
â”‚   â””â”€â”€ ...
â”œâ”€â”€ static/                                  â† é™æ€èµ„æº
â””â”€â”€ ...
```

### API Routes æ˜ å°„

| æºä»£ç è·¯å¾„ | æ„å»ºäº§ç‰©è·¯å¾„ | HTTP è·¯ç”± |
|-----------|-------------|----------|
| `src/app/api/auth/[...nextauth]/route.ts` | `.next/server/app/api/auth/[...nextauth]/route.js` | `/api/auth/*` |
| `src/app/api/session/route.ts` | `.next/server/app/api/session/route.js` | `/api/session` |

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§æœ¬æ–‡æ¡£æ“ä½œåä»æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æ„å»ºæ—¥å¿—** - æŸ¥çœ‹å®Œæ•´çš„æ„å»ºè¾“å‡º
2. **å¹³å°æ—¥å¿—** - åœ¨ ESA æ§åˆ¶å°æŸ¥çœ‹å‡½æ•°æ‰§è¡Œæ—¥å¿—
3. **æµè§ˆå™¨æ§åˆ¶å°** - æŸ¥çœ‹å‰ç«¯é”™è¯¯ä¿¡æ¯

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Next.js éƒ¨ç½²æ–‡æ¡£](https://nextjs.org/docs/deployment)
- [é¡¹ç›®æ ¹ç›®å½• README](../README.md)
- [é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æŒ‡å—](./README.md)

---

**éƒ¨ç½²æˆåŠŸåï¼Œåˆ«å¿˜äº†æ›´æ–° GitHub OAuth App çš„å›è°ƒ URLï¼** ğŸ‰
